// å¤šè¯­è¨€é…ç½®
const i18nConfig = {
    zh: {
        title: "Reactor Idle æ¸¸æˆå­˜æ¡£ä¿®æ”¹å·¥å…·",
        subtitle: "æœ¬å·¥å…·æ”¯æŒæ¸¸æˆå­˜æ¡£çš„è§£æä¸ä¿®æ”¹ã€‚å®˜æ–¹æ¸¸æˆé“¾æ¥ï¼šhttps://reactoridle.com/ã€æ±‰åŒ–ç‰ˆï¼šhttps://g8hh.github.io/reactoridle/",
        usageTitle: "ğŸ“‹ ä½¿ç”¨è¯´æ˜",
        usage1: "å­˜æ¡£è§£æï¼šä¸Šä¼ æˆ–ç²˜è´´æ¸¸æˆå­˜æ¡£æ–‡ä»¶ï¼Œè‡ªåŠ¨è§£æå¹¶æ˜¾ç¤ºæ¸¸æˆæ•°å€¼",
        usage2: "æ•°å€¼ä¿®æ”¹ï¼šåœ¨å‹ç¼©åŠŸèƒ½åŒºçš„æ•°å€¼æ¡†ä¸­ä¿®æ”¹é‡‘é’±ã€ç§‘æŠ€ã€å¥–åŠ±æ—¶åˆ»ç­‰æ•°å€¼",
        usage3: "å­˜æ¡£å‹ç¼©ï¼šä¿®æ”¹å®Œæˆåï¼Œç‚¹å‡»ã€Œæ‰§è¡Œå‹ç¼©ã€ç”Ÿæˆæ–°çš„æ¸¸æˆå­˜æ¡£",
        usage4: "ä¿å­˜ä½¿ç”¨ï¼šå¤åˆ¶æˆ–ä¸‹è½½å‹ç¼©åçš„å­˜æ¡£ï¼Œåœ¨æ¸¸æˆä¸­å¯¼å…¥ä½¿ç”¨",
        decompressTitle: "ğŸ” å­˜æ¡£è§£æ",
        decompressPlaceholder: "è¯·ç²˜è´´éœ€è¦è§£å‹çš„Base64å­—ç¬¦ä¸²ï¼Œæˆ–ä¸Šä¼ æ–‡ä»¶è‡ªåŠ¨å¡«å……...",
        decompressBtn: "æ‰§è¡Œè§£å‹",
        decompressLoading: "æ­£åœ¨è§£å‹ä¸­ï¼Œè¯·ç¨å€™...",
        money: "ğŸ’° é‡‘é’±",
        research: "ğŸ”¬ ç§‘æŠ€",
        bonus: "ğŸ å¥–åŠ±æ—¶åˆ»",
        decompressResult: "è¯·æ‰§è¡Œè§£å‹æ“ä½œä»¥æŸ¥çœ‹JSONç»“æœ",
        copyDecompress: "ä¸€é”®å¤åˆ¶è§£å‹ç»“æœ",
        saveDecompress: "ä¿å­˜è§£å‹ç»“æœä¸ºæ–‡ä»¶",
        clearDecompress: "æ¸…ç©ºå†…å®¹",
        compressTitle: "ğŸ“¦ å­˜æ¡£åˆ¶ä½œåŒº",
        syncBtn: "â†”ï¸ åŒæ­¥è§£å‹ç»“æœ",
        compressPlaceholder: "è¯·ç²˜è´´éœ€è¦å‹ç¼©çš„å­—ç¬¦ä¸²/JSONï¼Œæˆ–ä¸Šä¼ æ–‡ä»¶è‡ªåŠ¨å¡«å……ï¼Œä¹Ÿå¯ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŒæ­¥è§£å‹ç»“æœ...",
        compressBtn: "æ‰§è¡Œå‹ç¼©",
        compressLoading: "æ­£åœ¨å‹ç¼©ä¸­ï¼Œè¯·ç¨å€™...",
        copyCompress: "ä¸€é”®å¤åˆ¶æ¸¸æˆå­˜æ¡£",
        saveCompress: "ä¸‹è½½å‹ç¼©ç»“æœæ–‡ä»¶",
        clearCompress: "æ¸…ç©ºå†…å®¹",
        footer: "æœ¬é¡µé¢ç”± AI å·¥å…·è¾…åŠ©ç”Ÿæˆ",
        copied: "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",
        js: {
            inputRequired: "è¯·å…ˆè¾“å…¥æˆ–ä¸Šä¼ éœ€è¦è§£å‹çš„å†…å®¹ï¼",
            decompressFailed: "è§£å‹å¤±è´¥ï¼šè¾“å…¥å†…å®¹å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„Base64å‹ç¼©å­—ç¬¦ä¸²ã€‚",
            invalidArrayFormat: "éé¢„æœŸçš„æ•°ç»„æ ¼å¼ï¼",
            decompressRequired: "è¯·å…ˆæ‰§è¡Œè§£å‹æ“ä½œä»¥è·å–æ•°æ®ï¼",
            jsonParseError: "JSONæ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥å†…å®¹ï¼",
            invalidJsonFile: "æ–‡ä»¶å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼",
            jsonParseSuccess: "JSONè§£ææˆåŠŸï¼Œæ•°å€¼å·²åŒæ­¥ï¼",
            decompressSuccess: "è§£å‹æˆåŠŸï¼",
            compressSuccess: "å‹ç¼©æˆåŠŸï¼",
            valueSaved: "æ•°å€¼å·²ä¿å­˜ï¼",
            syncSuccess: "è§£å‹ç»“æœå·²åŒæ­¥ï¼",
            copySuccess: "å¤åˆ¶æˆåŠŸï¼",
            saveSuccess: "ä¿å­˜æˆåŠŸï¼",
            defaultResult: "è¯·æ‰§è¡Œè§£å‹æ“ä½œä»¥æŸ¥çœ‹JSONç»“æœ",
            compressParseError: "å‹ç¼©æ•°æ®å¤±è´¥",
            syncDecompressRequired: "è¯·å…ˆæ‰§è¡Œè§£å‹æ“ä½œä»¥åŒæ­¥æ•°æ®ï¼",
            syncDecompressSuccess: "è§£å‹ç»“æœå·²åŒæ­¥ï¼",
            compressInputRequired: "è¯·å…ˆè¾“å…¥æˆ–ä¸Šä¼ éœ€è¦å‹ç¼©çš„å†…å®¹ï¼",
            compressFailed: "å‹ç¼©å¤±è´¥ã€‚",
            compressUnknownType: "æœªçŸ¥ç±»å‹ï¼Œæ— æ³•å‹ç¼©ã€‚",
            compressIndexNegative: "ç´¢å¼•ä½ç½®ä¸èƒ½ä¸ºè´Ÿæ•°ï¼",
            saveFailed: "ä¿å­˜å¤±è´¥ï¼",
            copyFailed: "å¤åˆ¶å¤±è´¥ï¼",
            fillCompressValuesFailed: "å¡«å……å‹ç¼©æ•°å€¼å¤±è´¥ï¼",
            updateJSONFailed: "æ›´æ–°JSONå¤±è´¥ï¼"
        }
    },
    en: {
        title: "Reactor Idle Game Save Editor",
        subtitle: "This tool supports parsing and editing game save files. Official game: https://reactoridle.com/, Chinese version: https://g8hh.github.io/reactoridle/",
        usageTitle: "ğŸ“‹ Usage Guide",
        usage1: "Save Parsing: Upload or paste game save files to automatically parse and display game values",
        usage2: "Value Editing: Modify Money, Research, Bonus Ticks and other values in the compression area",
        usage3: "Save Compression: After editing, click 'Compress' to generate a new game save file",
        usage4: "Save & Use: Copy or download the compressed save file for import into the game",
        decompressTitle: "ğŸ” Save Parsing",
        decompressPlaceholder: "Paste game save string to decompress, or upload file to auto-fill...",
        decompressBtn: "Decompress",
        decompressLoading: "Decompressing, please wait...",
        money: "ğŸ’° Money",
        research: "ğŸ”¬ Research",
        bonus: "ğŸ Bonus Ticks",
        decompressResult: "Please decompress to view JSON result",
        copyDecompress: "One-Click Copy Result",
        saveDecompress: "Save as File",
        clearDecompress: "Clear Content",
        compressTitle: "ğŸ“¦ Save Creation",
        syncBtn: "â†”ï¸ Sync Decompressed Result",
        compressPlaceholder: "Paste string/JSON to compress, or upload file, or click above button to sync decompressed result...",
        compressBtn: "Compress",
        compressLoading: "Compressing, please wait...",
        copyCompress: "One-Click Copy Game Save",
        saveCompress: "Download Compressed File",
        clearCompress: "Clear Content",
        footer: "This page is AI-assisted",
        copied: "Copied to clipboard",
        js: {
            inputRequired: "Please input or upload content to decompress first!",
            decompressFailed: "Decompression failed: The input may not be a valid Base64 compressed string.",
            invalidArrayFormat: "Decompression result is not in the expected array format!",
            decompressRequired: "Please perform decompression first to get data!",
            jsonParseError: "JSON format error, please check the input content!",
            invalidJsonFile: "File content is not valid JSON format.",
            jsonParseSuccess: "JSON parsed successfully, values have been synchronized!",
            decompressSuccess: "Decompression successful!",
            compressSuccess: "Compression successful!",
            valueSaved: "Value saved successfully!",
            syncSuccess: "Decompression result synchronized!",
            copySuccess: "Copy successful!",
            saveSuccess: "Save successful!",
            defaultResult: "Please perform decompression to view JSON result",
            compressParseError: "Compression data failed",
            syncDecompressRequired: "Please perform decompression first to sync data!",
            syncDecompressSuccess: "Decompression result synchronized!",
            compressInputRequired: "Please input or upload content to compress first!",
            compressFailed: "Compression failed.",
            compressUnknownType: "Unknown type, cannot compress.",
            compressIndexNegative: "Index position cannot be negative!",
            saveFailed: "Save failed!",
            copyFailed: "Copy failed!",
            fillCompressValuesFailed: "Fill compress values failed!",
            updateJSONFailed: "Update JSON failed!"
        }
    }
};

// è¯­è¨€åˆ‡æ¢åŠŸèƒ½
function setLanguage(lang) {
    if (!i18nConfig[lang]) return;
    
    // æ›´æ–°é¡µé¢å…ƒç´ 
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (i18nConfig[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = i18nConfig[lang][key];
            } else {
                element.textContent = i18nConfig[lang][key];
            }
        }
    });
    
    // æ›´æ–°è¶…é“¾æ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    const links = document.querySelectorAll('[data-i18n-url]');
    links.forEach(link => {
        const key = link.getAttribute('data-i18n-url');
        if (i18nConfig[lang][key]) {
            link.href = i18nConfig[lang][key];
        }
    });
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    const langButtons = document.querySelectorAll('.lang-btn');
    langButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });
    
    // ä¿å­˜è¯­è¨€åå¥½
    localStorage.setItem('preferredLanguage', lang);
    
    // è®¾ç½®å…¨å±€è¯­è¨€å˜é‡ï¼Œä¾›JavaScriptä½¿ç”¨
    window.currentLanguage = lang;
}

// åˆå§‹åŒ–è¯­è¨€
function initLanguage() {
    const savedLang = localStorage.getItem('preferred-language') || 'zh';
    setLanguage(savedLang);

    // æ·»åŠ è¯­è¨€åˆ‡æ¢äº‹ä»¶ç›‘å¬
    document.getElementById('lang-zh').addEventListener('click', () => setLanguage('zh'));
    document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguage);
} else {
    initLanguage();
}

// JavaScriptå›½é™…åŒ–è¾…åŠ©å‡½æ•°
function t(key) {
    const lang = window.currentLanguage || 'zh';
    const keys = key.split('.');
    let value = i18nConfig[lang];
    
    for (const k of keys) {
        if (value && value[k] !== undefined) {
            value = value[k];
        } else {
            return key; // è¿”å›é”®åä½œä¸ºé»˜è®¤å€¼
        }
    }
    
    return value;
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.addEventListener('DOMContentLoaded', function() {
    initLanguage();
    
    // è®¾ç½®å…¨å±€è¯­è¨€å˜é‡
    const savedLang = localStorage.getItem('preferredLanguage') || 'zh';
    window.currentLanguage = savedLang;
});